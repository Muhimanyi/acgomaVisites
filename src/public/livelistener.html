<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Signalisation ACGOMA</title>
    <link rel="stylesheet" href="assets/css/output.css" />
    <script src="assets/js/jquery.js"></script>
    <script src="https://acgomavisites.onrender.com/socket.io/socket.io.js"></script>
    <style>
        /* Pour centrer le texte correctement */
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-image: url('live_audio.jpg');
            background-size: cover;
            color: white;
            text-align: center;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            text-shadow: 0 0 5px rgb(43, 92, 226);
        }

        .play-button {
            cursor: pointer;
            width: 100px;
            height: 100px;
            fill: white;
            background-color: #6b46c1; /* bg-violet-700 */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            transition: background-color 0.3s ease;
        }

        .play-button:hover {
            background-color: #805ad5;
        }

        audio {
            width: 300px;
            margin-top: 15px;
            outline: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="play-button" id="playPauseBtn" onclick="toggleAudio()" aria-label="Play/Pause">
            <svg id="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                <!-- Icône play par défaut -->
                <path fill-rule="evenodd"
                    d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z"
                    clip-rule="evenodd" />
            </svg>
        </div>

        <p style="font-size: 1.5rem; font-weight: bold;">
            ASSEMBLEE CHRETIENNE DE GOMA TMK - WEB-RADIO
        </p>

        <audio id="audio" controls autoplay style="display:none;"></audio>
    </div>

    <script>
        const socket = io();
        const audio = document.getElementById("audio");
        const icon = document.getElementById("icon");
        const playPauseBtn = document.getElementById("playPauseBtn");
        let isPlaying = false;

        // Fonction pour changer l'icône Play / Pause
        function updateIcon() {
            if (isPlaying) {
                // Pause icon (deux barres verticales)
                icon.innerHTML = `
                    <rect x="6" y="5" width="4" height="14" rx="1"></rect>
                    <rect x="14" y="5" width="4" height="14" rx="1"></rect>
                `;
            } else {
                // Play icon (triangle)
                icon.innerHTML = `
                    <path fill-rule="evenodd"
                        d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z"
                        clip-rule="evenodd" />
                `;
            }
        }

        // Fonction pour jouer ou mettre en pause l'audio
        function toggleAudio() {
            if (!audio.src) {
                console.error("No audio source available.");
                return;
            }

            if (audio.paused) {
                audio.play();
            } else {
                audio.pause();
            }
        }

        // Événements pour mettre à jour l'icône selon l'état audio
        audio.addEventListener('play', () => {
            isPlaying = true;
            updateIcon();
        });

        audio.addEventListener('pause', () => {
            isPlaying = false;
            updateIcon();
        });

        // Gestion des événements socket
        socket.on('liveAudio', (data) => {
            console.log('liveAudio:', data);
            audio.src = data;
            audio.play();
            audio.style.display = "block"; // afficher la barre audio seulement quand source est dispo
        });

        socket.on('links', (data) => {
            console.log('links:', data);
            if(data.links && data.links.lien){
                audio.src = data.links.lien;
                audio.play();
                audio.style.display = "block";
            }
        });

        // Initialiser l'icône au chargement
        updateIcon();
    </script>
</body>

</html>
